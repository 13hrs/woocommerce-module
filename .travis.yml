os: linux
dist: trusty

language: php

if: tag IS blank

stages:
  - test
  - deploy

before_script:
  - nvm install 10
  - bash tests/bin/install.sh wc_retailcrm_test root '' localhost $WP_VERSION

script: make tests

jobs:
  include:
    - php: 5.6
      env: WP_VERSION=latest WP_MULTISITE=0
    - stage: deploy
      deploy:
        cleanup: false
        provider: script
        script: make
      if: branch = master AND type = push AND fork = false